import{_ as se}from"./NIconButton.vue.ac7efd0c.js";import{_ as re}from"./NSelect.vue.3956d7b1.js";import{a as G,b4 as le,C as ue,r as j,l as q,D as T,b5 as z,ak as ie,a4 as ce,aj as de,L as me,y as p,z as h,u as n,o as r,c as _,w as l,b as u,f as c,H as D,e as d,F as w,m as U,t as k,p as E,j as i,aO as L,q as F,af as _e,v as pe,aV as fe,b6 as ye,b7 as O,J as ve,I as ge,P as he,h as ke,a6 as be}from"./entry.a0dd6aac.js";import{_ as xe}from"./NLink.vue.372e1ca0.js";import{_ as we}from"./NPanelGrids.54ee09bc.js";import{_ as Ce}from"./PanelLeftRight.vue.8031c7d4.js";import{_ as Ke}from"./FilepathItem.vue.3587ec1f.js";import{U as Ve}from"./json-editor-vue.b8dc29b2.js";import{_ as $e}from"./AuthRequiredPanel.vue.19da182f.js";import"./editor.aee50e2c.js";const Ne={class:"h-[48px] flex items-center justify-between gap1 px-3"},Se={class:"w-full text-sm"},Ie=["value"],je=u("div",{"x-divider":""},null,-1),qe={key:0,"h-full":"","of-hidden":"",flex:"~ col"},De={border:"b base",class:"h-[49px] flex flex-none items-center justify-between px-4 text-sm"},Ue={class:"flex items-center gap-4"},Le={key:1},Ae=["onKeyup"],Be=u("br",null,null,-1),Me={key:0,op50:""},Pe={key:1},Re=u("code",null,"nitro.storage",-1),Te=u("br",null,null,-1),ze={"font-bold":""},Ee=u("br",null,null,-1),Fe={"text-sm":""},Oe=u("br",null,null,-1),Ge=G({__name:"StorageDetails",async setup(H){let m,g;const C=le(),y=ue(),b=j(""),v=j(""),s=q({get(){return T().query?.storage},set(t){y.replace({query:{storage:t}})}}),e=j(),x=q(()=>T().query?.key),{data:K}=([m,g]=z(()=>O("storageMounts",()=>p.getStorageMounts())),m=await m,g(),m),{data:V,refresh:A}=([m,g]=z(async()=>O("storageKeys",async()=>s.value?await p.getStorageKeys(s.value):[])),m=await m,g(),m),J=C.hook("storage:key:update",async(t,o)=>{if(!(!s.value||t.split(":")[0]!==s.value)&&(await A(),x.value===t)){if(o==="remove")return y.replace({query:{storage:s.value}});await N(x.value)}});ie(J),ce(s,A),de(async()=>{if(!x.value){e.value=null;return}N(x.value)}),me("keydown",t=>{t.key==="s"&&(t.ctrlKey||t.metaKey)&&(S(),t.preventDefault())});function $(t){return t.replace(`${s.value}:`,"")}const W=q(()=>V.value?V.value.filter(t=>t.includes(b.value)):[]);async function N(t){const o=await p.getStorageItem(await h(),t);e.value={key:t,updatedKey:$(t),editingKey:!1,content:o,updatedContent:o}}async function Q(){if(!v.value||!s.value)return;const t=`${s.value}:${v.value}`;V.value?.includes(t)||await p.setStorageItem(await h(),t,""),y.replace({query:{storage:s.value,key:t}}),v.value=""}async function S(){e.value&&(await p.setStorageItem(await h(),e.value.key,e.value.updatedContent),await N(e.value.key))}async function X(){!e.value||!s.value||(await p.removeStorageItem(await h(),e.value.key),e.value=null)}async function Y(){if(!e.value||!s.value)return;const t=`${s.value}:${e.value.updatedKey}`,o=await h();await p.setStorageItem(o,t,e.value.updatedContent),await p.removeStorageItem(o,e.value.key),y.replace({query:{storage:s.value,key:t}})}return(t,o)=>{const Z=se,ee=re,I=ve,te=ge,ne=he,B=ke,M=xe,P=be,R=we,oe=Ce,ae=Ke;return n(s)?(r(),_(oe,{key:0,"storage-key":"tab-storage"},{left:l(()=>[u("div",Ne,[c(Z,{icon:"carbon-chevron-left","ml--1":"",onClick:o[0]||(o[0]=a=>s.value="")}),u("div",Se,[c(ee,{modelValue:n(s),"onUpdate:modelValue":o[1]||(o[1]=a=>D(s)?s.value=a:null),n:"primary",icon:"carbon-data-base"},{default:l(()=>[(r(!0),d(w,null,U(n(K),(a,f)=>(r(),d("option",{key:f,value:f},k(f),9,Ie))),128))]),_:1},8,["modelValue"])])]),c(I,{modelValue:n(b),"onUpdate:modelValue":o[2]||(o[2]=a=>D(b)?b.value=a:null),icon:"carbon-search",placeholder:"Search...",n:"primary sm",border:"y x-none base! rounded-0",class:"w-full py2 ring-0!"},null,8,["modelValue"]),(r(!0),d(w,null,U(n(W),a=>(r(),d(w,{key:a},[c(te,{block:"",truncate:"",px2:"",py1:"","font-mono":"","text-sm":"",to:{query:{key:a,storage:n(s)}},class:E(a===n(e)?.key?"text-primary n-bg-active":"text-secondary hover:n-bg-hover")},{default:l(()=>[i(k($(a)),1)]),_:2},1032,["to","class"]),je],64))),128)),c(I,{modelValue:n(v),"onUpdate:modelValue":o[3]||(o[3]=a=>D(v)?v.value=a:null),icon:"carbon-add",placeholder:"key",n:"sm",border:"t-none x-none base! rounded-0",class:"w-full py2 font-mono ring-0!",onKeyup:L(Q,["enter"])},null,8,["modelValue","onKeyup"])]),right:l(()=>[n(e)?.key?(r(),d("div",qe,[u("div",De,[u("div",Ue,[n(e).editingKey?(r(),_(I,{key:0,modelValue:n(e).updatedKey,"onUpdate:modelValue":o[4]||(o[4]=a=>n(e).updatedKey=a),onKeyup:L(Y,["enter"])},null,8,["modelValue","onKeyup"])):(r(),d("code",Le,[i(k($(n(e).key))+" ",1),c(ne,{icon:"carbon-edit",class:"cursor-pointer op50 hover:op100",onClick:o[5]||(o[5]=a=>n(e).editingKey=!0)})])),n(e).editingKey?F("",!0):(r(),_(B,{key:2,n:"green xs",disabled:n(e).content===n(e).updatedContent,class:E({"border-green":n(e).content!==n(e).updatedContent}),onClick:S},{default:l(()=>[i(" Save ")]),_:1},8,["disabled","class"]))]),u("div",null,[c(B,{n:"red xs",onClick:X},{default:l(()=>[i(" Delete ")]),_:1})])]),typeof n(e).content=="object"?(r(),_(n(Ve),_e({key:0,modelValue:n(e).updatedContent,"onUpdate:modelValue":o[6]||(o[6]=a=>n(e).updatedContent=a),class:[[t.$colorMode.value==="dark"?"jse-theme-dark":"light"],"json-editor-vue h-full of-auto text-sm outline-none"]},t.$attrs,{mode:"text","navigation-bar":!1,indentation:2,"tab-size":2}),null,16,["modelValue","class"])):pe((r(),d("textarea",{key:1,"onUpdate:modelValue":o[7]||(o[7]=a=>n(e).updatedContent=a),placeholder:"Item value...",class:"h-full of-auto p-4 font-mono text-sm outline-none",onKeyup:L(fe(S,["ctrl"]),["enter"])},null,40,Ae)),[[ye,n(e).updatedContent]])])):(r(),_(R,{key:1},{default:l(()=>[c(P,{px6:"",py4:""},{default:l(()=>[i(" Select one key to start."),Be,i("Learn more about "),c(M,{href:"https://nitro.unjs.io/guide/storage",n:"orange",target:"_blank"},{default:l(()=>[i(" Nitro storage ")]),_:1})]),_:1})]),_:1}))]),_:1})):(r(),_(R,{key:1},{default:l(()=>[Object.keys(n(K)).length?(r(),d("p",Me," Select one storage to start: ")):(r(),d("p",Pe,[i(" No custom storage defined in "),Re,i("."),Te,i(" Learn more about "),c(M,{href:"https://nitro.unjs.io/guide/storage",n:"orange",target:"_blank"},{default:l(()=>[i(" Nitro storage ")]),_:1})])),(r(!0),d(w,null,U(n(K),(a,f)=>(r(),_(P,{key:f,"min-w-80":"","cursor-pointer":"","p-4":"","text-left":"",hover:"border-green",onClick:He=>s.value=f},{default:l(()=>[u("span",ze,k(f),1),Ee,u("span",Fe,k(a.driver)+" driver",1),Oe,a.base?(r(),_(ae,{key:0,"text-xs":"",filepath:a.base},null,8,["filepath"])):F("",!0)]),_:2},1032,["onClick"]))),128))]),_:1}))}}}),at=G({__name:"storage",setup(H){return(m,g)=>{const C=Ge,y=$e;return r(),_(y,null,{default:l(()=>[c(C)]),_:1})}}});export{at as default};
