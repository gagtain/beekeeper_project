{"version":3,"file":"isAuth-d5b9643f.js","sources":["../../../../middleware/isAuth.js"],"sourcesContent":["import verifAssessToken from \"../additional_func/verifAssessToken\"\nimport { defineEventHandler } from 'h3';\nimport { useMainStore } from \"../store\";\nexport default  defineEventHandler( async (event) => {\n  console.log(event)\n  /* Попытка авторизовать пользователя на всех переходах  */\n  const stores = useMainStore()\n    if (useCookie('assess').value || useCookie('refresh').value){\n      // проверка токена\n      stores.assess_token = useCookie('assess')\n      let assess_response = await verifAssessToken(stores.assess_token)\n      if (!(assess_response.status == 200)){\n      // если нет\n          if (useCookie('refresh')){\n              console.log('Есть рефреш')\n              return // установить новый токен\n          }else{\n            if (event.href != '/login' && event.href != '/register'){\n              return '/login'\n            }\n          }\n      }else{\n        console.log(222)\n        stores.userSet(assess_response.data)\n      }\n  }else{\n\n    let assess_response = await verifAssessToken()\n    console.log(assess_response.status, 123)\n      if (!(assess_response.status == 200)){\n      // если нет\n            if (event.href != '/login' && event.href != '/register'){\n              return '/login'\n            }\n      }else{\n        console.log(222)\n        stores.userSet(assess_response.data)\n      }\n  } \n}\n\n)\n  // import verifAssessToken from \"../additional_func/verifAssessToken\"\n\n  // export default async (event) => {\n  //       let assess_response = await verifAssessToken()\n  //       if (!(assess_response.status == 200)){\n  //       // если нет\n  //           if (useCookie('refresh')){\n  //               console.log('Есть рефреш')\n  //               return\n  //               // проверка рефреша \n  //               // если верен то вернуть страницу\n  //               // если не верен то перейти на логин\n  //           }else{\n  //               console.log('Нет рефреша')\n  //               if (event.req.url != '/login'){\n          \n  //                 return sendRedirect(event, '/login', 302)\n  //               }else{\n  //                 event.context.$assess_token = '123'\n  //               }\n    \n  //           }\n  //       }\n        \n        \n        \n  //       // if запрос верен, document.cookie = \"token=\" + token\n  //       // else проверка на refresh, если он верен то запись токена\n  //       // else return next('/login')\n    \n  //   }"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;AAGA,MAAA,SAAgB;AAAA,EAAoB,OAAO,UAAU;AACnD,YAAQ,IAAI,KAAK;AAEjB,UAAM,SAAS,aAAc;AAC3B,QAAI,UAAU,QAAQ,EAAE,SAAS,UAAU,SAAS,EAAE,OAAM;AAE1D,aAAO,eAAe,UAAU,QAAQ;AACxC,UAAI,kBAAkB,MAAM,iBAAiB,OAAO,YAAY;AAChE,UAAI,EAAE,gBAAgB,UAAU,MAAK;AAEjC,YAAI,UAAU,SAAS,GAAE;AACrB,kBAAQ,IAAI,aAAa;AACzB;AAAA,QACd,OAAe;AACH,cAAI,MAAM,QAAQ,YAAY,MAAM,QAAQ,aAAY;AACtD,mBAAO;AAAA,UACR;AAAA,QACF;AAAA,MACX,OAAW;AACH,gBAAQ,IAAI,GAAG;AACf,eAAO,QAAQ,gBAAgB,IAAI;AAAA,MACpC;AAAA,IACP,OAAO;AAEH,UAAI,kBAAkB,MAAM,iBAAkB;AAC9C,cAAQ,IAAI,gBAAgB,QAAQ,GAAG;AACrC,UAAI,EAAE,gBAAgB,UAAU,MAAK;AAE/B,YAAI,MAAM,QAAQ,YAAY,MAAM,QAAQ,aAAY;AACtD,iBAAO;AAAA,QACR;AAAA,MACb,OAAW;AACH,gBAAQ,IAAI,GAAG;AACf,eAAO,QAAQ,gBAAgB,IAAI;AAAA,MACpC;AAAA,IACJ;AAAA,EACH;AAEA;"}